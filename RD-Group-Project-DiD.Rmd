---
title: "RD-Group-Project-DiD"
author: "Sophie Hensgen"
date: "11/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(readr)
library(tidyverse)
library(stargazer)
library(plotly)
```

## Load Data Set


```{r load data set}
df <- read.table("public.dat")
df

```

## Code


```{r arrange data, echo=FALSE}

# arrange data to better observe

arrange(df, V1)

```

```{r Rename Varibales, echo=FALSE}

## changing into tibble
df <- as_tibble(df)

## Rename Columns for a better workflow
# x stands for independent variable/covariates
# y stands for dependent variable
# d stands for treatement variable
df <- df %>% 
  rename(
    x_id = V1,
    x_store.name = V2, #chain 1=bk; 2=kfc; 3=roys; 4=wendys
    x_co.owned = V3,
    d_state = V4, #
    x_south.j = V5,
    x_central.j = V6,
    x_north.j = V7,
    x_northeast.pa = V8,
    x_easton.pa = V9,
    x_shore.j = V10, #
    x_callbacks.first = V11,
    y_full.emp = V12,
    y_part.emp = V13,
    y_managers = V14,
    x_st.wage.before = V15,
    x_months.raise = V16, 
    x_amount.raise = V17,
    x_cash.bounty = V18,
    y_employees.affected.n.minimum = V19,
    x_reduced = V20,
    x_open.hour = V21,
    x_open.per.day = V22,
    x_medium.soda = V23,
    x_small.fries = V24,
    x_entree = V25,
    x_cash.reg = V26,
    x_reg.11 = V27, 
    x_type.sec.interview = V28, # second wave
    x_status.sec.interview = V29,
    x_date.sec = V30,
    x_callbacks.sec = V31,
    y_full.emp.sec = V32,
    y_part.emp.sec = V33,
    y_managers.sec = V34,
    x_st.wage.after = V35,
    x_months.raise.sec = V36,
    x_amount.raise.sec = V37,
    x_special.program.sec = V38,
    x_reduced.price = V39,
    x_open.hour.sec = V40,
    x_open.per.day.sec = V41,
    x_medium.soda.sec = V42,
    x_small.fries.sec = V43,
    x_entree.sec = V44,
    x_cash.reg.sec = V45,
    x_reg.11.sec = V46
    )

```

```{r Creating Variables, echo=FALSE}

# Creating a new variable which says 1 if the restaurant was interviewed in the first wave
df$x_interviewed.w1 <- (df$x_interviewed.w1 = 1)

# creating new variables for each store (x_store.name) and state (d_state) into dummies. 

# x_bk dummy variable for burger king (1) or not (0)
df$x_bk <- gsub(2, 0, df$x_store.name) 
df$x_bk <- gsub(3, 0, df$x_bk) 
df$x_bk <- gsub(4, 0, df$x_bk) 

# x_kfc dummy variable for KFC (1) or not (0)
df$x_kfc <- gsub(1, 0, df$x_store.name) 
df$x_kfc <- gsub(3, 0, df$x_kfc) 
df$x_kfc <- gsub(4, 0, df$x_kfc) 
df$x_kfc <- gsub(2, 1, df$x_kfc) 

# x_roys dummy variable for Roys (1) or not (0)
df$x_roys <- gsub(1, 0, df$x_store.name) 
df$x_roys <- gsub(2, 0, df$x_roys) 
df$x_roys <- gsub(4, 0, df$x_roys) 
df$x_roys <- gsub(3, 1, df$x_roys) 

# x_wendys dummy variable for Wendys (1) or not (0)
df$x_wendys <- gsub(1, 0, df$x_store.name) 
df$x_wendys <- gsub(3, 0, df$x_wendys) 
df$x_wendys <- gsub(2, 0, df$x_wendys) 
df$x_wendys <- gsub(4, 1, df$x_wendys)

# d_nj dummy variable for restaurants in NJ (1) or not (0)
df$d_nj <- df$d_state

# d_nj dummy variable for restaurants in PA (1) or not (0)
df$d_pa <- gsub(1, 2, df$d_state)
df$d_pa <- gsub(0, 1, df$d_pa)
df$d_pa <- gsub(2, 0, df$d_pa)


```

```{r changing class , echo=FALSE}

# Some variables are a character vector, which cannot be used in a summary. Therefore they have to be changed. 

df[,12:17] <- lapply(df[,12:17], as.factor) #first convert into factor, and then into numeric. if tried to convert idrectly from character into numeric a error will appear.
df[,12:17] <- lapply(df[,12:17], as.numeric)

df[,19] <- lapply(df[,19], as.factor)
df[,19] <- lapply(df[,19], as.numeric)

df[,23:27] <- lapply(df[,23:27], as.factor)
df[,23:27] <- lapply(df[,23:27], as.numeric)

df[,31:46] <- lapply(df[,31:46], as.factor)
df[,31:46] <- lapply(df[,31:46], as.numeric)

df[,48:51] <- lapply(df[,48:51], as.factor)
df[,48:51] <- lapply(df[,48:51], as.numeric)

df[,53] <- lapply(df[,53], as.factor)
df[,53] <- lapply(df[,53], as.numeric)

str(df)
```

```{r, echo=FALSE}
#Summary Statistic of a subset of the data frame df

#subsetting the data frame
df.select <- df %>%
  select(x_co.owned, x_south.j, x_central.j, x_north.j, x_northeast.pa, x_easton.pa, x_st.wage.before, x_st.wage.after, x_open.per.day, x_open.per.day.sec, y_full.emp, y_full.emp.sec, d_state, x_store.name)

#summary of the subset
stargazer(data.frame(df.select), type = "text", summary = TRUE)

```


```{r Table 1 - Sample Size and response rate, echo=FALSE}

# first wave
# d_state

# count number interviewed
count.all.w1 <- df %>% 
  count(d_state)

count.all.w1

# response rate nj
count.all.per <- df %>%
  tally(x_interviewed.w1)%>%
  mutate(percent = n/473)

# response rate nj
count.nj.per <- df %>%
  count(d_state) %>%
  filter(d_state == 1) %>%
  mutate(percent = n/364)

# response rate pa
count.pa.per <- df %>%
  count(d_state) %>%
  filter(d_state == 0) %>%
  mutate(percent = n/109)

# second wave
# x_status.sec.interview, d_state

count.all.w2 <- df %>% 
  count(x_status.sec.interview)

count.nj <- df %>% 
  filter(d_state == 1) %>% # NJ
  count(x_status.sec.interview)

count.pa <- df %>% 
  filter(d_state == 0) %>% # PA
  count(x_status.sec.interview)

count.all.w2
count.nj
count.pa

```

```{r Table 2 - Means of Key Variables, echo=FALSE}

# Khizer 


```

```{r Figure 1 - Distribution of starting wage rates, echo=FALSE}

# Sophie 

### Replication of Figure 1

## creating specific objects for starter wage before respectively for nj and pa

x_st.wage.before.nj <- df$x_st.wage.before[df$d_nj == 1]
x_st.wage.before.pa <- df$x_st.wage.before[df$d_pa == 1]

# Plot for before treatment

# Set histogram bins
xbins <- list(start=4.20, end=5.60)

# 
p.before <- plot_ly(alpha = 0.5) %>%
  add_histogram(x = x_st.wage.before.nj, 
                  #xbins = c(4.20, 5.60, 0.5),
                  histnorm = "percent", 
                  name = "Wage Before (New Jersey)") %>%
  add_histogram(x = x_st.wage.before.pa, 
                  #xbins = c(4.20, 5.60, 0.5),
                  histnorm = "percent",
                  name = "Wage Before (Pennsylvania)") %>%
  layout(barmode = "group", title = "February 1992",
           xaxis = list(tickvals=seq(4.25, 5.55, 0.1),
                        title = "Wage in $ per hour"),
           yaxis = list(range = c(0, 50)),
                      margin = list(b = 100, 
                          l = 80, 
                          r = 80, 
                          t = 80, 
                          pad = 0, 
                          autoexpand = TRUE))

p.before

## creating specific objects for starter wage before respectively for nj and pa

x_st.wage.after.nj <- df$x_st.wage.after[df$d_nj == 1]
x_st.wage.after.pa <- df$x_st.wage.after[df$d_pa == 1]

# Plot for wage after treatment

p.after <- plot_ly(alpha = 0.5) %>%
  add_histogram(x = x_st.wage.after.nj, 
                  xbins = c(4.25, 5.60, 0.5),
                  histnorm = "percent", 
                  name = "Wage After (New Jersey)") %>%
  add_histogram(x = x_st.wage.after.pa, 
                  xbins = c(4.25, 5.60, 0.5),
                  histnorm = "percent",
                  name = "Wage After (Pennsylvania)") %>%
  layout(barmode = "group", title = "February 1992",
           xaxis = list(tickvals=seq(4.25, 5.55, 0.1),
                        title = "Wage in $ per hour"),
           yaxis = list(range = c(0, 50)),
                      margin = list(b = 100, 
                          l = 80, 
                          r = 80, 
                          t = 80, 
                          pad = 0, 
                          autoexpand = TRUE))

p.after
```

```{r Table 3 - Average eMployment per store before and after the raise, echo=FALSE}

# Sophie


```

```{r Table 4 - Reduced Form Models for change in employment, echo=FALSE}

# Sophie 


```

```{r Table 5 - Specification tests of reduced form employment models, echo=FALSE}

# Khizer


```












